# 服务管理

## # 系统运行级别 ##

0 ：关机
1 ：单用户模式，可以想象成windows的安全模式，主要用于系统修复，作用是启动最小的服务，保证系统运行就可以
2 ：不完全的命令行模式(就是不完整的字符界面)，不含NFS服务
3 ：完全的命令行模式，也就是标准字符界面
4 ：系统保留
5 ：图形模式
6 ：重启动

1. 查看系统级别：
命令runlevel: 结果是'上次运行的级别数 当前运行的系统级别数'，(N是空的意思，一般是刚开机时没有进行过级别切换，所以上一级别为空)

2. 修改系统运行级别：
命令"init 级别数"

## # 服务分类 ##

Linux服务分为：源码包安装的服务是可以转换成PRM包安装的服务的，但是为了逻辑更清晰，还是将服务分为一下两种。

1. PRM包默认服务(一般不指定安装目录，由服务默认安装)
   * 独立的服务 (独立占自己的内存)
   * 基于xinetd服务 (守护进程，该服务下有很多后台程序，访问这些程序要通过xinetd服务，这些后台程序回应也要经过xinetd，但是这些后台服务不占内存资源，基本淘汰)

2. 源码包安装的服务(一般指定安装目录)

注：两种方式在安装后的不同点就是安装位置的不一样

服务启动：

查看已安装服务及其启动方式：
命令：chkconfig --list   (只能查看PRM方式安装的服务)
命令结果：
如 ：
network   0:关  1:关  2:开  3:开  4:开  5:开  6:关  (0~6表示系统运行级别，开表示自启动服务，跟当前服务是否启动没有关系)

1. 服务启动 (就是在当前系统中让服务运行，并提供功能)
2. 服务自启动 (开机或者重启之后，随着系统的启动而启动的服务)

查看端口对应的服务：
用编辑打开/etc/services，这个文件中列出了常用的端口号对应得服务

查询系统中开启得服务：
命令：
netstat -tlunp
选项：
-t: 列出tcp数据
-u: 列出udp数据
-l: 列出正在监听的网络服务(不包含已经连接的网络服务)
-n: 用端口号来显示服务，而不是用服务名
-p: 列出服务的进程ID（PID）

### RPM包服务管理 ###

1. RPM包安装服务的位置

  源码包安装在指定位置，一般是/usr/local/

  RPM包安装在默认位置中(一般不指定位置，由服务自己默认)

2. 独立服务的启动

 /etc/init.d/独立服务名      （通过绝对路径启动,标准启动方法，所有linux都可行）
 (start|stop|status|restart)

 service 独立服务名           (通过service启动，这个只有redhat类发行版才有service，不能启动源码包服务，但是如果手动将源码包的启动脚本拷到/etc/init.d/ 中后就可以使用，service启动了)
 (start|stop|status|restart)

3. 独立服务的自启动

   * chkconfig [--level 运行级别] [独立服务名] [on|off] (方法1)
   * 修改/etc/rc.d/rc.local文件 (方法2，两个方法二选一，两个都用的话其中一个就会报错)
   * 使用ntsysv命令管理自启动  (方法3，和方法1是同一种方法，redhat独有)

### 源码包服务管理 ###

1. 源码包服务的安装位置

  源码包安装在指定位置，一般是/usr/local/

  RPM包安装在默认位置中(一般不指定位置，由服务自己默认)

2. 源码包服务的启动
  
	使用绝对路径，调用启动脚本来启动 + [start|stop]。不同源码包的启动脚本不同。可以查看源码包的安装说明，查看启动脚本的方法。

  如果linux是属于redhat下的发行版的话，还可以将服务的启动脚本软链接或者cp到/etc/init.d/(或者是/etc/rc.d/init.d/与/etc/init.d/目录是软链接关系)下即可使用service启动服务

3. 让源码包被chkconfig与ntsysv命令识别（chkconfig与ntsysv命令通用，加了chkconfig，同时ntsysv也可以用了）

  * 一先在文件'/etc/init.d/启动文件' 中加入"# chkconfig:35[启动级别,自己根据实际情况赋值] 86[启动顺序，不能和系统现有的重合，关闭顺序也一样] 76[关闭顺序]" 和 "# description:source package apache" 其中'#'这里不是代表注释, 而"# description:source package apache"相当于对加进来的内容进行注释
  * 二执行'chkconfig --add 服务名'   (将源码包服务加入chkconfig命令)

>知识点整理: 位于etc/rc.d下的rc1.d~rc6.d是系统运行级别的控制目录，当系统运行级别启动时会将对应目录中S开头的文件都执行起来就启动了改系统运行级别，关闭系统运行级别的时候将对应目录中K开头的文件都杀死就是停止该系统运行级别。而这些S开头的文件名中包含的数字部分就是启动顺序，K开头的文件名中包含的数字就是关闭顺序。
